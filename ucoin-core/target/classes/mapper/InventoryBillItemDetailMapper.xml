<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ylife.inventory.mapper.InventoryBillItemDetailMapper">

    <resultMap id="BaseResultMap" type="com.ylife.inventory.model.InventoryBillItemDetail">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="item_id" property="itemId" jdbcType="BIGINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="receipt_amount" property="receiptAmount" jdbcType="INTEGER"/>
        <result column="is_visible" property="isVisible" jdbcType="BIT"/>
        <result column="product_time" property="productTime" jdbcType="DATE"/>
        <result column="end_time" property="endTime" jdbcType="DATE"/>
        <result column="end_warn_day" property="endWarnDay" jdbcType="INTEGER"/>

    </resultMap>

    <sql id="Base_Column_List">
        item_id, id, receipt_amount,product_time,end_time,end_warn_day,create_time
    </sql>

    <update id="updateByInventory" >

   UPDATE chinapost_inventory_bill_item_detail
   SET is_visible = 0
   WHERE
	id IN (
		SELECT
			aa.id

				FROM
      (
       SELECT chinapost_inventory_bill_item_detail.id
        FROM
				chinapost_inventory_bill_item_detail
				LEFT JOIN chinapost_inventory_bill_item ON chinapost_inventory_bill_item.item_id = chinapost_inventory_bill_item_detail.item_id
				LEFT JOIN chinapost_inventory_bill ON chinapost_inventory_bill.bill_id = chinapost_inventory_bill_item.bill_id
				WHERE
					chinapost_inventory_bill.in_id =#{id}
				AND chinapost_inventory_bill_item.goods_info_id =#{goodsInfoId}
			) aa
	)
    </update>






    <update id="updateWarnDay" parameterType="com.ylife.inventory.model.InventoryBillItemDetail">
        UPDATE
        chinapost_inventory_bill_item_detail
        <set>

                is_visible=1,
                product_time=#{productTime},
                end_time=#{endTime},
                end_warn_day=#{endWarnDay},
            <if test="receiptAmount!=null">
                receipt_amount=#{receiptAmount},
            </if>
            <if test="createTime!=null">
                create_time=#{createTime},
            </if>
            <if test="itemId!=null">
                item_id=#{itemId}
            </if>

        </set>
        WHERE chinapost_inventory_bill_item_detail.id =#{id}
    </update>



    <select id="select" resultMap="BaseResultMap" parameterType="java.lang.Long">
        select
        <include refid="Base_Column_List"/>
        from chinapost_inventory_bill_item_detail
        where item_id = #{itemId,jdbcType=BIGINT}
        AND chinapost_inventory_bill_item_detail.is_visible=1
    </select>


    <insert id="insertSelective" parameterType="com.ylife.inventory.model.InventoryBillItemDetail" keyProperty="id"
            useGeneratedKeys="true">
        insert into chinapost_inventory_bill_item_detail
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="itemId != null">
                item_id,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="receiptAmount != null">
                receipt_amount,
            </if>
            <if test="productTime != null">
                product_time,
            </if>
            <if test="endTime != null">
                end_time,
            </if>
            <if test="endWarnDay != null">
                end_warn_day,
            </if>
            <if test="isVisible != null">
                is_visible,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="itemId != null">
                #{itemId,jdbcType=BIGINT},
            </if>
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>

            <if test="receiptAmount != null">
                #{receiptAmount,jdbcType=INTEGER},
            </if>
            <if test="productTime != null">
                #{productTime,jdbcType=DATE},
            </if>
            <if test="endTime != null">
                #{endTime,jdbcType=DATE},
            </if>
            <if test="endWarnDay != null">
                #{endWarnDay,jdbcType=INTEGER},
            </if>
            <if test="isVisible != null">
                #{is_visible,jdbcType=BIT},
            </if>
        </trim>
    </insert>
    <update id="deleteWarnDay" parameterType="java.lang.Long">
        UPDATE
        chinapost_inventory_bill_item_detail
        SET chinapost_inventory_bill_item_detail.is_visible=0
        WHERE chinapost_inventory_bill_item_detail.id =#{id}
    </update>
</mapper>