package com.ylife.chinapost.third.controller;

import com.ylife.chinapost.third.service.LoginService;
import com.ylife.utils.MyLogger;
import com.ylife.utils.StringUtil;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;

/**
 * Created by suibian on 2017-06-30.
 */
@Controller
public class LoginController {
    /**
     * 日志记录 *
     */
    private static final MyLogger LOGGER = new MyLogger(LoginController.class);

    @Resource
    private LoginService loginService;

    /**
     * 账号密码登录third
     * @param userName 用户名
     * @param password 密码
     * @param code 验证码
     * @return
     * */
    @RequestMapping("/checkLogin")
    @ResponseBody
    public String checkLogin(HttpServletRequest request,String userName, String password, String code){
        Integer num;
        if (null == code || !code.equals(request.getSession().getAttribute("k_captcha_text_key"))) {
            num = 202;
        }else if(StringUtil.isBlank(userName) || StringUtil.isBlank(password)){
            num = 203;
        }else {
            num = loginService.checkLogin(request,userName,password);
        }
        return num.toString();
    }

    /**
     * 退出登录
     *
     * @return ModelAndView
     */
    @RequestMapping("/login")
    public ModelAndView logOut(HttpServletRequest request) {
        // 退出登陆
        request.getSession().removeAttribute("loginUserId");
        request.getSession().removeAttribute("name");
        return new ModelAndView("/login");
    }
}
