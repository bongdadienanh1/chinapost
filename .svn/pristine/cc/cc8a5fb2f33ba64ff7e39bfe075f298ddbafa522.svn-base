
<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>商城第三方后台-商品管理</title>
<#assign basePath=request.contextPath />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" type="text/css" href="${basePath}/static/css/third.css?v=201707011506"/>
    <link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.3.1/css/bootstrap.min.css?v=20151016234"/>
    <link href="http://cdn.bootcss.com/bootstrap-datepicker/1.4.0/css/bootstrap-datepicker.min.css?v=20151016234" rel="stylesheet">
    <link href="${basePath}/static/css/material.css?v=20151016234" rel="stylesheet">
    <link href="${basePath}/static/css/ripples.css?v=20151016234" rel="stylesheet">
    <link rel="stylesheet" href="${basePath}/static/css/style.css?v=20170630"/>
    <link rel="stylesheet" href="${basePath}/static/css/select2.min.css"/>
    <link rel="stylesheet" href="${basePath}/static/css/bootstrap-datetimepicker.min.css" >
    <script type="text/javascript" src="${basePath}/static/js/jquery.min.js?v=20151016234"></script>
    <script src="http://cdn.staticfile.org/twitter-bootstrap/3.3.1/js/bootstrap.min.js?v=20151016234"></script>
    <script src="${basePath}/static/js/ripples.min.js?v=20151016234"></script>
    <script src="${basePath}/static/js/material.min.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/third.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/goods/goods_vali.js?v=20151016234"></script>
<#--<script type="text/javascript" src="${basePath}/static/js/goods/thirdgoods.js?v=20170702"></script>-->
<#--<script type="text/javascript" src="${basePath}/static/js/goods/thirdOrderList.js"></script>-->
    <script type="text/javascript" src="${basePath}/static/js/goods/thirdBackOrderList.js"></script>
    <script type="text/javascript" src="${basePath}/static/js/goods/newupload.js?v=201707021754"></script>
    <script type="text/javascript" src="${basePath}/static/js/common.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/artDialog4.1.7/artDialog.source.js?skin=default"></script>
    <script type="text/javascript" src="${basePath}/static/js/artDialog4.1.7/plugins/iframeTools.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/jquery.slimscroll.min.js?v=20151016234"></script>
    <link rel="stylesheet" type="text/css" href="${basePath}/static/css/summernote.css?v=20151016234">
    <script type="text/javascript" src="${basePath}/static/js/summernote.min.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/summernote-zh-CN.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/jquery.validate.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/common/common_alert.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/common/common_date.js?v=20151016234"></script>
    <script src="${basePath}/static/js/app.js?v=20151016234"></script>
    <link rel="stylesheet" type="text/css" href="${basePath}/static/css/goodsAdd.css?v=20151016234"/>
    <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css?v=20151016234"/>
    <link rel="stylesheet" href="${basePath}/static/css/bootstrap-chosen.css?v=20151016234"/>
    <script src="${basePath}/static/js/chosen.jquery.min.js?v=20151016234"></script>
    <script type="text/javascript" src="${basePath}/static/js/angular.min.js?v=20151016234"></script>
    <script charset="utf-8" src="${basePath}/static/js/kindeditor/kindeditor.js"></script>
    <script charset="utf-8" src="${basePath}/static/js/kindeditor/lang/zh_CN.js"></script>
    <script charset="utf-8" src="${basePath}/static/js/kindeditor/plugins/code/prettify.js"></script>
    <script src="${basePath}/static/js/select2.min.js"></script>
    <script type="text/javascript" src="${basePath}/static/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="${basePath}/static/js/bootstrap-datetimepicker.zh-CN.js"></script>
</head>
<body>
<#--引入头部-->
<#include "index/indextop.ftl">


<div class="wp">
    <input type="hidden" value="${isThirdAuditUsed!''}" id="isThirdAuditUsed"/>
    <div class="ui-sidebar">
        <div class="sidebar-nav">
        <#import "index/indexleft.ftl" as leftmenu>
        <@leftmenu.leftmenu '${basePath}' />
        </div>
    </div>

    <div class="app show_text" style="display: none;">
        <div class="app-container">
            <ol class="breadcrumb">
                <li>您所在的位置</li>
                <li>订单管理</li>
                <li class="active" style="color: #07d;">退单列表</li>
            </ol>
            <div class="group_wp">
                <form action="" class="searchThirdOrderList" method="post">
                    <div class="search-block">
                        <div class="filter-groups">
                            <div class="control-group">
                                <label class="control-label">退单编号：</label>
                                <div class="controls">
                                    <input class="form-control" value="${backOrderNo!''}" name="backOrderNo" onkeyup="value=value.replace(/[^\w\/]/ig,'')" type="text" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">手机号码：</label>
                                <div class="controls">
                                    <input class="form-control" name="phoneNo" value="${phoneNo!''}" type="text"/>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">订单编号：</label>
                                <div class="controls">
                                    <input class="form-control" value="${orderNo!''}" name="orderNo" onkeyup="value=value.replace(/[^\w\/]/ig,'')" type="text" />
                                </div>
                            </div>

                        <#--<div class="control-group">-->
                        <#--<label class="control-label">收货人姓名：</label>-->
                        <#--<div class="controls">-->
                        <#--<input class="form-control" name="username" value="${username!''}" type="text" />-->
                        <#--</div>-->
                        <#--</div>-->
                            <div class="control-group lg-group">
                                <label class="control-label">退单时间：</label>
                                <div class="controls">
                                    <input type="text" name="start" class="form-control sm-input datepicker" value="${start!''}" data-provide="datepicker"/>
                                    ~
                                    <input type="text" name="end" class="form-control sm-input datepicker" value="${end!''}" data-provide="datepicker"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="search-operation">
                        <button class="btn btn-primary btn-sm"  onclick="searchOrder()" type="button">查询<i class="glyphicon glyphicon-search"></i></button>
                    <#--<button class="btn btn-default btn-sm"  onclick="resetThirdOrder()"  type="button">重置<i class="glyphicon glyphicon-refresh"></i></button>-->
                    </div>
                </form>
                <div class="mt20 clearfix"></div>
                <ul class="nav nav-tabs">
                    <li class="active tb_backOrderJj" ><a href="javascript:;">全部退单</a></li>
                </ul>
                <div class="cfg-content">
                    <div class="ops-bar"></div>
                    <form class="high_search" action="" method="post">
                        <table class="table table-bordered orders-table">
                            <thead>
                            <tr>
                                <th width="20%">商品</th>
                                <th>数量</th>
                                <th>买家</th>
                                <th width="12%">退单时间</th>
                                <th>退单状态</th>
                                <th>退单金额</th>
                                <th>结算价</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <#if (pageBean.content?size) &gt; 0 >
                                <#list pageBean.content as backOrder>
                                <tr class="separation-row">
                                    <td colspan="9"></td>
                                </tr>
                                <tr class="header-row">
                                    <td colspan="7">
                                        <p>退单编号：${backOrder.backOrderCode!''}</p>
                                    </td>
                                    <td class="row-ops" colspan="4">
                                        <a class="modi-order" href="javascript:;" onclick="modiOrder(${backOrder.backOrderCode})">查看详情</a>
                                    </td>
                                </tr>
                                <tr class="content-row">
                                    <td class="order-pros">
                                        <#assign goodsCont = 0/>
                                    <#--订单结算价-->
                                        <#assign goodsInfoSettlePrice=0/>
                                    <#--遍历该订单下面的所有商品的信息-->
                                        <#list backOrder.backOrderGoods as goods>
                                            <a href="javascript:;" title="${goods.goodsInfoName}"><img src="${goods.goodsInfoImage!''}" alt="${goods.goodsInfoName}" width="60" height="60"/></a>
                                            <#assign goodsCont = goodsCont+goods.goodsNum/>
                                        <#--计算结算价-->
                                            <#assign goodsInfoSettlePrice=goodsInfoSettlePrice+goods.goodsInfoSettlePrice*goods.goodsInfoNum/>
                                        </#list>
                                    </td>
                                    <td>
                                        （${goodsCont!'0'}件）
                                    </td>
                                    <td style="line-height: 20px;">${backOrder.backCollectPerson!''}<br/>${backOrder.backCollectPhone!''}</td>
                                    <td>${backOrder.backTime?string("yyyy-MM-dd hh:mm:ss")}</td>
                                    <td>${backOrder.backCheck!''}</td>
                                <#--判断是店铺入驻商城还是供货商入驻商城的订单-->
                                    <td>${backOrder.backPrice!'0.00'}邮豆</td>
                                    <td>￥ ${goodsInfoSettlePrice}</td>
                                    <td>

                                        <div class="btn-group">
                                            <a class="btn btn-primary btn-sm modi-order" href="javascript:;">操作</a>
                                            <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                                <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu" role="menu">
                                                <#if backOrder.backCheck == "审核退款">
                                                    <li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'1')" data-target="#Order_Money">同意退款</a></li>
                                                    <li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'2')" data-target="#Order_Money">拒绝退款</a></li>

                                                </#if>
                                                <#if backOrder.backCheck == "退货申请">
                                                    <li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'1')" data-target="#Order_Money">同意退货</a></li>
                                                    <li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'2')" data-target="#Order_Money">拒接退货</a></li>
                                                </#if>
                                                <#if backOrder.backCheck == "待收货">
                                                    <li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'3')" data-target="#Order_Money">同意收货</a></li>
                                                    <li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'4')" data-target="#Order_Money">拒接收货</a></li>
                                                </#if>
                                                <#if backOrder.backCheck == "退货待退款">
                                                    <li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'5')" data-target="#Order_Money">同意退款</a></li>
                                                    <#--<li><a href="" data-toggle="modal" onclick="fnModifyBackOrderMoney(this,${backOrder.backOrderCode},'2')" data-target="#Order_Money">拒接退款</a></li>-->
                                                </#if>
                                            <#--<li><a href="" data-toggle="modal" onclick="fnModifyBackOrder(<#if order.backOrderId??>${order.backOrderId}</#if>)" data-target="#modifyState">订单审核</a></li>-->
                                            </ul>
                                        </div>
                                    </td>

                                </tr>
                                </#list>
                            <#else >
                            <td colspan="12">
                                <center>暂无相关商品信息</center>
                            </td>
                            </#if>
                            </tbody>
                        </table>
                    </form>
                    <div class="footer-operation">
                        <div class="ops-left">
                        <#if order.orderCargoStatus??&&  order.orderCargoStatus=="0">
                            <button class="btn btn-primary btn-xs"  onclick="pickingOrderIds()" type="button">批量拣货</button>
                        </#if>
                        </div>
                    <#include "index/searchPag.ftl">
                    </div>
                </div>
            </div>
            <div class="app-content backOrderDeal" style="display: none">
                <div class="order-num" data-order-type="backOn"></div>
                <div class="order-det">
                    <div class="od-tit"><h3>退单详情</h3></div>
                    <div class="od-cont">
                        <table>
                            <tbody>
                            <tr>
                                <td style="width: 30%" data-order-type="orderCode"><em>订单号：</em>${backorder.orderCode }</td>
                                <td style="width: 30%" data-order-type="shippingCounty"><em>收货人地址：</em>${backorder.order.shippingProvince!''}  ${backorder.order.shippingCity!''}   ${backorder.order.shippingCounty!''}</td>
                                <td data-order-type="text" data-order-type="backReason"><em>退货原因：</em>
                                <#--<#if backorder.backReason??>-->
                                <#--<#if backorder.backReason=='1'>不想买了</#if>-->
                                <#--<#if backorder.backReason=='2'>收货人信息有误</#if>-->
                                <#--<#if backorder.backReason=='3'>商品损坏</#if>-->
                                <#--<#if backorder.backReason=='4'>其他</#if>-->
                                <#--</#if>-->
                                </td>
                            </tr>
                            <tr>
                                <td data-order-type="backTime"><em>退单时间：</em></td>
                                <td data-order-type="shippingAddress"><em>详细地址：</em></td>
                            </tr>
                            <tr>
                                <td data-order-type="backCheck"><em>退单状态：</em></td>
                                <td data-order-type="backCollectPerson"><em>收货人姓名：</em>${backorder.order.shippingPerson}</td>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <table class="table">
                    <thead>
                    <tr>
                        <th width="300">退单商品</th>
                        <th>商品个数</th>
                    <#--<th>原始价格</th>
                    <th>交易价格</th>-->
                        <th>退单总价</th>
                    </tr>
                    </thead>
                    <tbody>
                    <#--<#if backorder.orderGoodslistVo??>-->
                    <#--<#list backorder.orderGoodslistVo as orderGoods>-->
                    <tr>
                        <td>
                            <a href="javascript:;"><img alt="" width="30px" height="30px" src="${orderGoods.goodsInfoImgId!'' }" /></a>
                        </td>
                        <td>111件</td>
                        <td>¥100</td>
                    </tr>
                    <#--</#list>-->
                    <#--</#if>-->
                    </tbody>
                    <tfoot></tfoot>
                </table>
                <div class="add-sorts-operation">
                    <a class="btn btn-primary" onclick="updateCancel()">关闭</a>
                </div>
            </div>
        </div>
    </div>
</div>
<#--</form>-->
<#include "common/leftfooter.ftl">


<script type="text/javascript" src="${basePath}/static/js/navmenu.js?v=20151016234"></script>
<script>
    $(function(){
        $.material.init();
        $(".chosen-select").chosen();
        $(".brandsChosen").chosen();
        $('.datepicker').datetimepicker({
            format: 'yyyy/mm/dd hh:mm:ss',
            weekStart : 1,
            autoclose : true,
            language : 'zh-CN',
            todayBtn : true,
            viewSelect : 'hour'
        })
    });

    /*用于控制显示div层  先显示头部和左边 稍后在显示里面的内容*/
    function show(){
        $(".show_text").fadeOut(1000).fadeIn(1000);
    }
    setTimeout("show()",1000);

    function getInputVal(obj){
        $("#basic-proPack").html($(obj).val()+"/箱");
    }
    //搜索
    function searchOrder(){
        $(".searchThirdOrderList").attr('action','${basePath}/orderManage/getBackOrders');
        searchData(1)
    }
    //分页
    function searchData(pageNumber){
        $("#page").val(pageNumber);
        $(".searchThirdOrderList").submit();
    }

//    $(".modi-order").click(function () {
//
//    });

    function modiOrder(backOrderCode){
        $(".backOrderDeal").find("data-order-type").html('');
        $.post("getBackOrderGoods?backOrderCode="+backOrderCode,function(data){
            if(data.response == 'success'){
                var demoData = data.data;
                $(".backOrderDeal").find("data-order-type").each(function(){
                    $(this).html(eval('demoData.'+$(this).attr("data-order-type")));
                })
            }
        });
        $(".group_wp").hide();
        $(".app-content").show();
    }

    function updateCancel(){
        $(".app-content").hide();
        $(".group_wp").show();
    }

    function fnModifyBackOrderMoney(_this,backOrderCode,type){
        var url = 'orderStateChange?backOrderCode='+backOrderCode+'&whetherType='+type;
        var tips = '你确定要'+$(_this).text()+'吗?';
        showDeleteOneConfirmAlert(url,tips);
    }
</script>
<#--<#import "common/selectindex.ftl" as selectindex>-->
<#--<@selectindex.selectindex "${n!''}" "${l!''}" />-->

</body>
</html>
