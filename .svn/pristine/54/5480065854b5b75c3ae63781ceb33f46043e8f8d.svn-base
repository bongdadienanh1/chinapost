package com.ylife.chinapost.boss.controller;

import com.alibaba.fastjson.JSON;
import com.google.gson.reflect.TypeToken;
import com.ylife.chinapost.boss.controller.utils.Constants;
import com.ylife.chinapost.boss.service.GoodsBrandBossService;
import com.ylife.data.page.Page;
import com.ylife.data.page.Pageable;
import com.ylife.goods.model.GoodsBrand;
import com.ylife.utils.Assert;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;
import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import java.util.List;

/**
 * Created by Administrator on 2017/6/30.
 * 商品品牌管理
 */
@Controller
@RequestMapping(value = "/GoodsBrand")
public class GoodsBrandController {

	@Resource
	GoodsBrandBossService goodsBrandBossService;

	private final String MODULE_PATH = "/";

	public static final String NAME = "name";


	private String returnPath(String jspName) {
		return MODULE_PATH+ jspName;
	}

	/**
	 * 获取商品品牌
	 * @param brandName
	 * @param brandNickname
	 * @param page
	 * @param size
	 * @return
	 */
	@RequestMapping(value = "/getGoodsBrand")
	@ResponseBody
	public ModelAndView getGoodsBrands(@RequestParam(value = "brandName", required = false) String brandName,
	                             @RequestParam(value = "brandNickname", required = false) String brandNickname,
	                             @RequestParam(value = "page", required = false, defaultValue = "1") int page,
	                             @RequestParam(value = "size", required = false, defaultValue = "10") int size){
		brandName = Constants.nullOrNotBlank(brandName);
		brandNickname = Constants.nullOrNotBlank(brandNickname);
		Page<GoodsBrand> pageList = goodsBrandBossService.queryBrandByNameOrBrandNickname(brandName, brandNickname, new Pageable(page, size));
		return new ModelAndView(returnPath("GoodsBrand")).addObject("pageList",pageList);
	}

	/**
	 * 添加商品品牌
	 * @param brandName
	 * @param brandNickname
	 * @param brandUrl
	 * @param brandSort
	 * @return 1成功 0失败
	 */
	@RequestMapping(value = "/saveGoodsBrand")
	@ResponseBody
	public ModelAndView saveGoodsBrand(@RequestParam(value = "brandName") String brandName,
	                             @RequestParam(value = "brandNickname", required = false) String brandNickname,
	                             @RequestParam(value = "brandUrl", required = false) String brandUrl,
	                             @RequestParam(value = "brandSort") String brandSort, HttpServletRequest request){
		String userName = (String) request.getSession().getAttribute(NAME);
		Assert.notNull(brandName);
		Assert.notNull(brandSort);
		brandNickname = Constants.nullOrNotBlank(brandNickname);
		brandUrl = Constants.nullOrNotBlank(brandUrl);
		int result = goodsBrandBossService.insertGoodsBrand(brandName,brandNickname, brandUrl, Integer.valueOf(brandSort), userName);
		return new ModelAndView("redirect:getGoodsBrand").addObject("",result);
	}

	/**
	 * 批量删除商品品牌
	 * @param brandIds
	 * @return
	 */
	@RequestMapping(value = "/deleteGoodsBrand")
	@ResponseBody
	public ModelAndView deleteGoodsBrand(@RequestParam("brandIds") String brandIds, HttpServletRequest request){
		long[] ids = Constants.SIMPLE_PARSER.parseJSON(brandIds, new TypeToken<long[]>() {
		});
		String deleteName = (String) request.getSession().getAttribute(NAME);
		for (Long brandId : ids) {
			goodsBrandBossService.deleteGoodsBrand(brandId, deleteName);
		}
		return new ModelAndView("redirect:getGoodsBrand");
	}

	/**
	 * 删除一条商品品牌
	 * @param brandId
	 * @return 1成功，0失败
	 */
	@RequestMapping(value = "/deleteOneGoodsBrand")
	@ResponseBody
	public ModelAndView deleteOneGoodsBrand(@RequestParam("brandId") String brandId, HttpServletRequest request){
		String deleteName = (String) request.getSession().getAttribute(NAME);
		int result = goodsBrandBossService.deleteGoodsBrand(Long.valueOf(brandId), deleteName);
		return new ModelAndView("redirect:getGoodsBrand").addObject(result);
	}

	/**
	 * 修改商品品牌信息
	 * @param brandId
	 * @param brandName
	 * @param brandNickname
	 * @param brandUrl
	 * @param brandSort
	 * @return 1成功，0失败
	 */
	@RequestMapping(value = "/editGoodsBrand")
	@ResponseBody
	public ModelAndView editGoodsBrand(@RequestParam(value = "brandId") String brandId,
	                             @RequestParam(value = "brandName") String brandName,
	                             @RequestParam(value = "brandNickname", required = false) String brandNickname,
	                             @RequestParam(value = "brandUrl", required = false) String brandUrl,
	                             @RequestParam(value = "brandSort") String brandSort, HttpServletRequest request){
		String userName = (String) request.getSession().getAttribute(NAME);
		Assert.notNull(brandName);
		Assert.notNull(brandSort);
		brandNickname = Constants.nullOrNotBlank(brandNickname);
		brandUrl = Constants.nullOrNotBlank(brandUrl);
		int result = goodsBrandBossService.updateGoodsBrad(Long.valueOf(brandId), brandName, brandNickname, brandUrl, Integer.valueOf(brandSort), userName);
		return new ModelAndView("redirect:getGoodsBrand").addObject(result);
	}

	/**
	 * 查询所有品牌信息
	 *
	 * @return
	 */
	@RequestMapping(value = "/queryAllBrand")
	@ResponseBody
	public List<GoodsBrand> queryAllBrandList() {
		// 执行方法并返回结果
		return goodsBrandBossService.queryAllBrand();
	}


	/**
	 * 检查品牌是否存在
	 * @param brandName
	 * @return
	 */
	@RequestMapping(value = "/checkGoodsBrandName", produces = "application/text;charset=utf-8")
	@ResponseBody
	public String checkGoodsBrandName(@RequestParam(value = "brandName") String brandName){
		return goodsBrandBossService.checkGoodsBrandName(brandName) == true?"用户名可以使用":"该用户名称已被使用";
	}

	/**
	 * 查询GoodsBrand
	 * @author henry
	 * @date 2017-06-30 18:46:32
	 * */
	@RequestMapping(value = "/queryBrandById", produces = "application/json;charset=utf-8")
	@ResponseBody
	public String findGoodsBrand(String brandId) {
		return JSON.toJSONString(goodsBrandBossService.queryBrandById(Long.parseLong(brandId)));
	}


}
