<#assign bath = request.contextPath>
<link rel="stylesheet" href="${bath}/static/css/font-awesome.min.css">
<link href="${bath}/static/iconfont/iconfont.css" rel="stylesheet">
<style>
    .ctrl_nav li>a>i {
        margin:0 auto 10px;
    }
    .modal-dialog{
        margin:90px auto;
    }
    .modal-article {padding: 0 10px; height: 400px; overflow-y: scroll;}
    .modal-article p {line-height: 180%; font-size: 16px; position: relative; padding-left: 50px;}
    .modal-article p em {font-style: normal; position: absolute; top: 0; left: 0;}
    .modal-article img {display: block; width: 100%; margin: 10px auto 20px;}
    h1 {
        font-size: 18px;
        font-weight: normal;
    }
    .shop-guide-wrapper {
        width: 780px;
        margin: 0 auto;
    }
    .shop-guide-wrapper .mtitle, .shop-guide-wrapper .mbody {
        border: 1px solid #ECECEC;
    }
    .shop-guide-wrapper .mtitle {
        height: 85px;
        background-color: #F8F8F8;
        text-align: center;
        border-radius: 5px 5px 0 0;
        box-shadow: inset 0 0 10px #ECECEC;
    }
    .shop-guide-wrapper .mbody {
        height: 332px;
        border-top: 0;
        border-radius: 0 0 5px 5px;
        position: relative;
    }

    .shop-guide-wrapper .stepInsts {
        width: 770px;
        padding-top: 18px;
        margin: 0 auto;
    }
    .shop-guide-wrapper .stepInsts .stepShow {
        height: 25px;
        background-image: url(../images/guide-step-sprite.png);
        background-repeat: no-repeat;
    }
    .shop-guide-wrapper .stepInsts ul {
        *zoom: 1;
        margin-left:97px;
    }
    .shop-guide-wrapper .stepInsts ul:before, .shop-guide-wrapper .stepInsts ul:after {
        display: table;
        content: "";
        line-height: 0;
    }
    .shop-guide-wrapper .stepInsts ul:after {
        clear: both;
    }
    .shop-guide-wrapper .stepInsts ul li {
        width: 96px;
        height: 18px;
        padding: 9px 0;
        font-size: 14px;
        color: #68676C;
        line-height: 18px;
        text-align: center;
        float: left;
    }
    .shop-guide-wrapper .stepInsts ul li.past {
        color: #333;
    }
    .shop-guide-wrapper .stepInsts ul li.finish {
        color: #C00;
    }
    .shop-guide-wrapper .step-0 .stepShow {
        background-position: center 0;
    }
    .shop-guide-wrapper .step-1 .stepShow {
        background-position: center -25px;
    }
    .shop-guide-wrapper .step-2 .stepShow {
        background-position: center -50px;
    }
    .shop-guide-wrapper .step-3 .stepShow {
        background-position: center -75px;
    }
    .shop-guide-wrapper .step-4 .stepShow {
        background-position: center -100px;
    }
    .shop-guide-wrapper .step-5 .stepShow {
        background-position: center -125px;
    }
    .shop-guide-wrapper .step-6 .stepShow {
        background-position: center -150px;
    }
    .shop-guide-wrapper .step-7 .stepShow {
        background-position: center -175px;
    }
    .shop-guide-wrapper .step-8 .stepShow {
        background-position: center -200px;
    }
    .shop-guide-wrapper .center-btn-wrapper {
        text-align: center;
        margin-top: 50px;
    }
    .shop-guide-wrapper .corner-btn-wrapper {
        position: absolute;
        right: 45px;
        bottom: 20px;
    }
    .shop-guide-wrapper .inner-content {
        padding: 15px 45px 0;
    }
    .shop-guide-wrapper .inner-content .content {
        padding-left: 70px;
        height: 178px;
        overflow-y: auto;
    }
    .shop-guide-wrapper .centered-content {
        padding: 60px 0 0;
        text-align: center;
    }
    .shop-guide-wrapper .mtitle h1 {
        text-align: center;
        margin: 30px 0 0;
    }
    .shop-guide-wrapper .mbody .stepInsts {
        padding-top: 44px;
    }

</style>

<div class="page_top container-fluid Noprint">
    <div class="row">
        <div class="col-lg-4 col-md-5 col-sm-6">
            <h1 class="logo"><a href="index.htm"><img alt="" width="75%" src="${indexLogo }" id="logo"></a></h1>
        </div>
        <div class="col-lg-20 col-md-19 col-sm-18">
            <div class="top_banner">
                <div class="ctrl_banner">
                    <ul class="ctrl_nav pull-right">
                        <li>
                            <a href="javascript:void(0);" onclick="goOut();">
                                <i class="icon icon-white icon-off"></i>&nbsp;退出
                            </a>
                        </li>

                    </ul>
                    <p class="version" style="color: #ffffff">标准版（2.0.5-RELEASE） </p>
                </div>

                <div class="nav_area">
                    <div class="user_data pull-right">
                        <ul>
                            <li>
                                <a href="javascript:modifyInfo();">
                                    <img class="vm mr10" id="m_img" alt="" src="${bath}/static/images/avatar.jpg"
                                             height="25" style="margin-top:-3px;"/>
                                    <font size="4">&nbsp;&nbsp;<small>${name }</small></font>

                                </a>
                            </li>
                        </ul>
                    </div>
                    <nav class="nav_boss pull-left">
                        <ul>
                            <li class="active"><a href="javascript:;">首页模板</a></li>
                            <li><a href="javascript:;">专题页模板</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>




<div id="goout" class="modal fade Noprint" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">退出系统</h4>
            </div>
            <form class="form-horizontal" method="post" action="login.htm">
                <div class="modal-body">
                    <div class="form-group">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-7">
                            <p class="text-muted">您确定要退出系统吗？</p>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-primary"/>
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                </div>
            </form>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->






<#--<div id="dalog-updatepass-sms" class="modal fade Noprint" role="dialog">-->
    <#--<div class="modal-dialog">-->
        <#--<div class="modal-content">-->
            <#--<div class="modal-header">-->
                <#--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
                <#--<h4 class="modal-title">修改密码</h4>-->
            <#--</div>-->
            <#--<div class="modal-body">-->
                <#--<form class="form-horizontal"  method="post" id="updatePassForm">-->
                    <#--<div class="form-group">-->
                        <#--<label class="control-label col-sm-5"><span class="text-danger">*</span>原始密码：</label>-->
                        <#--<div class="col-sm-1"></div>-->
                        <#--<div class="col-sm-10">-->
                            <#--<input class="form-control required" rows="5" name="userkey" id="userkey" type="password"/><span id="oldpass"></span>-->
                        <#--</div>-->
                    <#--</div>-->
                    <#--<div class="form-group">-->
                        <#--<label class="control-label col-sm-5"><span class="text-danger">*</span>新密码：</label>-->
                        <#--<div class="col-sm-1"></div>-->
                        <#--<div class="col-sm-10">-->
                            <#--<input class="form-control required" rows="5" name="newuserkey" id="newuserkey" type="password"/>-->
                        <#--</div>-->
                    <#--</div>-->

                    <#--<div class="form-group">-->
                        <#--<label class="control-label col-sm-5 required"><span class="text-danger">*</span>重复新密码：</label>-->
                        <#--<div class="col-sm-1"></div>-->
                        <#--<div class="col-sm-10">-->
                            <#--<input class="form-control" rows="5"  equalTo="#newuserkey" name="renewuserkey" id="renewuserkey" type="password"/>-->
                        <#--</div>-->
                    <#--</div>-->


                <#--</form>-->
            <#--</div>-->
            <#--<div class="modal-footer">-->
                <#--<button type="button" class="btn btn-primary" onclick="updatepass();">确定</button>-->
                <#--<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>-->
            <#--</div>-->
        <#--</div><!-- /.modal-content &ndash;&gt;-->
    <#--</div><!-- /.modal-dialog &ndash;&gt;-->
<#--</div><!-- /.modal &ndash;&gt;-->






<#--<div id="dalog-Info-sms" class="modal fade Noprint" role="dialog" style="z-index:1700;" >-->
    <#--<div class="modal-dialog" style="z-index:1800;">-->
        <#--<div class="modal-content">-->
            <#--<div class="modal-header">-->
                <#--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
                <#--<h4 class="modal-title">修改资料</h4>-->
            <#--</div>-->
            <#--<div class="modal-body">-->
                <#--<form class="form-horizontal"  method="post" id="InfoForm" action="modifymanager.htm?CSRFToken=${token }" enctype="multipart/form-data">-->
                    <#--<div class="form-group">-->
                        <#--<label class="control-label col-sm-5"><span class="text-danger">*</span>用户名：</label>-->
                        <#--<div class="col-sm-1"></div>-->
                        <#--<div class="col-sm-10">-->
                            <#--<input id="manaid" name="id" type="hidden" value="${loginUserId }">-->
                            <#--<label class="radio-inline"> <span class="usernamen">${name }</span></label>-->
                        <#--</div>-->
                    <#--</div>-->
                    <#--<div class="form-group">-->
                        <#--<label class="control-label col-sm-5">头像：</label>-->
                        <#--<div class="col-sm-1"></div>-->
                        <#--<div class="col-sm-1">-->
                            <#--<input name="photoImg" id="photoImg1" type="hidden" value="${photoImg }">-->
                            <#--<img src="${photoImg }" height="30" height="30" id="headImgs"/>-->
                        <#--</div>-->
                        <#--<div class="col-sm-1"></div>-->
                        <#--<div class="col-sm-2"><input id="chooseAdminImg" type="button" value="选择"/></div>-->
                    <#--</div>-->
                    <#--<div class="form-group">-->
                        <#--<label class="control-label col-sm-5">手机号：</label>-->
                        <#--<div class="col-sm-1"></div>-->
                        <#--<div class="col-sm-10">-->
                            <#--<input class="form-control mobile" rows="5"  id="mobileupdate" name="mobile"/>-->
                        <#--</div>-->
                    <#--</div>-->
                <#--</form>-->
            <#--</div>-->
            <#--<div class="modal-footer">-->
                <#--<button type="button" class="btn btn-primary" onclick="subInfoForm();">确定</button>-->
                <#--<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>-->
            <#--</div>-->
        <#--</div><!-- /.modal-content &ndash;&gt;-->
    <#--</div><!-- /.modal-dialog &ndash;&gt;-->
<#--</div><!-- /.modal &ndash;&gt;-->




<script src="${bath}/static/js/jquery.min.js"></script>
<script type="text/javascript" src="${bath}/static/js/jquery.qrcode.min.js"></script>
<script type="text/javascript" src="${bath}/static/js/jquery.validate.js"></script>
<script type="text/javascript" src="${bath}/static/js/artDialog4.1.7/artDialog.source.js"></script>
<script type="text/javascript" src="${bath}/static/js/artDialog4.1.7/plugins/iframeTools.js"></script>
<script type="text/javascript" src="${bath}/static/js/jquery.cookie.js"></script>


<script type="text/javascript">

    $(function(){


        var logoflag = "${indexLogo }";
        if(logoflag==null||logoflag==''){
            //获取登录logo
            $.ajax({
                url: "ajaxGetSysBasic.htm",

                success: function(data){
                    if(data.indexLogo!=""){
                        $("#logo").attr("src",data.indexLogo);
                    }
                }});
        }


        $.ajax({
            url:"getBasicSetName.htm",
            success:function(data){
                if(data!=""){
                    $('#link').attr("href",data.bsetAddress);
                    $('#shouye').attr("href",data.bsetAddress);
                    $("title").html("${pageName} - "+data.bsetName);
                    $('#thirdlink').attr("href",data.bsetThirdAddress);
                    jQuery('#erweima').qrcode({
                        render  : "canvas",
                        width   : 50,
                        height  : 50,
                        text    : data.bsetAddress
                    });
                }
            }});



        /* 导航弹出菜单 */

        $('.nav ul li').each(function(){
            $(this).mouseenter(function(e){
                var positionX =$(this).width()/2 - 200;
                $(this).append('<div class="menu_down popover bottom" style="position:absolute;top: 32px; left: ' + positionX + 'px; display: block;"><div class="arrow" style="left: 44%;"></div><div class="popover-content">' + $(this).next().html() + '</div></div>');
                $(this).mouseleave(function(){
                    $(this).find(".menu_down").remove();
                });
            });

        });


        $.ajax({
            url: "initNotice.htm?"+Math.random(),
            context: document.body,
            async:true,
            success: function(data){

                /* 顶部右侧功能辅助导航 */
                var message_num = data.count,//信息数量
                        $message = '';

                if(data.list!=null&&data.list.length!=0){
                    for (var i = 0; i < data.list.length; i++) {
                        var d= new Date(data.list[i].payTime);
                        $message+='<p><a href="orderlist.htm?menuId=89&menuParentId=1165&myselfId=947&orderCode='+data.list[i].orderNo+'"';
                        if(i==0){
                            $message+='class="text-danger"';
                        }
                        $message+='>';
                        $message+='<span>'+(setNumToTen(d.getMonth()+1))+'-'+setNumToTen(d.getDate())+'</span>';
                        $message+='<i class="glyphicon glyphicon-comment"></i>';
                        $message+='订单:'+data.list[i].orderNo+'</a>';
                        $message+='</p>';
                    }
                    $(".message_list").html($message);
                    $("#messagecount").html('您有<span>'+message_num+'</span>条未读消息');
                }

            }});


    });


    function setNumToTen(data){
        if(data<10){
            return "0"+data;
        }else{
            return data;
        }

    }


    function goOut(){
        $('#goout').modal('show');
    }

    var uurl='getmobile.htm?CSRFToken=${token}';

    function fankui(){
        if($("#feedbackcontent").val()!=''){
            $("#feedbackcontent").removeClass('error');
            jQuery.ajax({
                url : "sendemailusersite.htm?CSRFToken=${token}&feedbackname=${name }&feedbackcontent="+$("#feedbackcontent").val(),
                success : function(html) {
                    if (html == 1) {
                        $('#feedback').modal('hide');
                        $("#feedbackcontent").val('');
                        showNoAlert('反馈成功');
                    } else {
                        $('#feedback').modal('hide');
                        showNoAlert('反馈失败');

                    }
                }
            });
        }else{
            $("#feedbackcontent").addClass('error');
        }

    }

    /**
     * 删除单个记录的确认框
     * @param deleteUrl 删除链接。
     */
    function showNoAlert(tips) {
        $("#ViewmodalDialog").remove();
        var confirmDialog =
                '<div class="modal fade" id="ViewmodalDialog"  role="dialog">'+
                '    <div class="modal-dialog">'+
                '        <div class="modal-content">'+
                '            <div class="modal-header">'+
                '                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+
                '               <h4 class="modal-title">系统提示</h4>'+
                '           </div>'+
                '           <div class="modal-body">'+tips+
                '           </div>'+
                '           <div class="modal-footer">'+
                '               <button type="button" class="btn btn-default" data-dismiss="modal" onclick="$(\'#ViewmodalDialog\').modal(\'hide\');">确定</button>'+
                '           </div>'+
                '       </div>'+
                '   </div>'+
                '</div>';
        $(document.body).append(confirmDialog);
        $('#ViewmodalDialog').modal('show');
    }

    var updateFlag = '';
    function modifyPwd(){
        $('#mcode').val('');
        $('#userkeyold').val('');
        //修改密码
        updateFlag = '0';
        $.ajax({
            type : 'post',
            url : uurl,
            success : function(data) {
                if(data.mobile == null || data.mobile.trim().length == 0){
                    $("#dalog-checkPass-sms").modal('show');
                }else{
                    $("#viewmobile").text(data.mobile);
                    $("#dalog-send-sms").modal("show");
                }
            }
        });
    }


    function modifyInfo(){
        $('#mcode').val('');
        $('#userkeyold').val('');
        //修改资料
        updateFlag = '1';
        $.ajax({
            type : 'post',
            url : uurl,
            success : function(data) {
                if(data.mobile == null || data.mobile.trim().length == 0){
                    $("#dalog-checkPass-sms").modal("show");
                }else{
                    $("#viewmobile").text(data.mobile);
                    $("#dalog-send-sms").modal("show");
                }
            }
        });
    }

    function sendCode(){
        // var url = 'getcodecore.htm?code='+code+"&CSRFToken="+$("#hi_token").val();
        var url = 'sendcodecore.htm?mobile='+$(".mobile").text()+"&CSRFToken=${token}";
        $.ajax({
            type : 'post',
            url : url,
            async : false,
            success : function(data) {
                if (data > 0) {

                    time($("#sendCodeButton"));
                    $("#sendCodeButtonTip").text('发送成功');
                } else if(data == 0) {
                    $("#sendCodeButtonTip").text('发送失败');
                }else if(data == -1){
                    $("#sendCodeButtonTip").text('60秒内只能发送一次!');
                }
            }
        });
    }

    var wait = 60;
    function time(o) {
        if (wait == 0) {
            o.attr("disabled", false);
            o.val('发送验证码');
            wait = 60;
        } else {
            o.attr("disabled", true);
            o.val("重新发送(" + wait + ")");
            wait--;
            setTimeout(function() {
                        time(o);
                    },
                    1000);
        }
    }


    function checkCode(){
        if( $("#sendCodeForm").valid()){
            var url = 'getcodecore.htm?code='+$("#mcode").val()+"&CSRFToken=${token}";
            $.ajax({
                type : 'post',
                url : url,
                async : false,
                success : function(data) {
                    if (data > 0) {

                        if(updateFlag=='0'){
                            $("#dalog-send-sms").modal("hide");
                            $("#dalog-updatepass-sms").modal('show');
                        }else{
                            getMobileForm();
                            $("#dalog-send-sms").modal("hide");
                            $("#dalog-Info-sms").modal('show');
                        }


                    } else if(data == 0) {
                        $("#mcode").addClass('error');
                        $("#errorCode").html("<label class='error'>验证码不正确</label>");
                        return;
                    }else if(data == -1){
                        $("#mcode").addClass('error');
                        $("#errorCode").html("<label class='error'>验证码已过期</label>");

                        return;
                    }
                }
            });
        }


    }

    function checkPass(){
        if($("#checkPassForm").valid()){
            var userkey=$("#userkeyold");
            var url="checkUserKeyMain.htm?userKey="+userkey.val()+"&CSRFToken=${token}";
            $.ajax({
                type: 'post',
                url:url,
                async:false,
                success: function(data) {
                    if (data > 0){
                        $("#dalog-checkPass-sms").modal('hide');
                        if(updateFlag=='0'){
                            $("#dalog-updatepass-sms").modal('show');
                        }else{
                            getMobileForm();
                            $("#dalog-Info-sms").modal('show');
                        }
                    } else {
                        $("#userkeyold").addClass('error');
                        $("#oldpassuse").html('<label class="error">原始密码不正确</label>');
                    }
                }
            });
        }

    }

    function getMobileForm(){
        $.ajax({
            type : 'post',
            url : 'getmobile.htm?CSRFToken=${token}',
            success : function(data) {
                if(data.mobile != null && data.mobile.trim().length != 0){
                    $("#mobileupdate").val(data.mobile);
                }

            }
        });
    }
    function updatepass(){
        if($("#updatePassForm").valid()){
            var bValid = true;
            var userkey=$("#userkey"),
                    newuserkey=$("#newuserkey");
            var url="checkUserKey.htm?userKey="+userkey.val()+"&CSRFToken=${token}";
            $.ajax({
                type: 'post',
                url:url,
                async:false,
                success: function(data) {
                    if (data > 0){
                        bValid=true&&bValid;
                    } else {
                        $("#userkey").addClass('error');
                        $("#oldpass").html('<label class="error">原始密码不正确</label>');
                        bValid=false&&bValid;
                    }
                }
            });

            if(bValid){
                var url="modifiedUserKey.htm?userKey="+userkey.val()+"&newuserkey="+newuserkey.val()+"&CSRFToken=${token}";
                $.ajax({
                    type: 'post',
                    url:url,
                    async:false,
                    success: function(data) {
                        if (data > 0){
                            $("#dalog-updatepass-sms").modal('hide');
                            showNoAlert('修改成功');
                        } else {
                            $("#dalog-updatepass-sms").modal('hide');
                            $("#mcode").val('');
                            showNoAlert('修改失败');
                        }
                    }
                });
            }


        }


    }




    //图片回调
    function saveChoooseImageHead(url,id) {
        if(typeof (url) != 'string') {
            url = url[0];
        }
        if(url.indexOf(',')!=-1){
            url=url.substring(0,url.indexOf(','));
        }

        $("#headImgs").attr("src",url);
        $("#photoImg1").val(url);

    }

    function subInfoForm(){
        if($("#InfoForm").valid()){
            $("#InfoForm").submit();
        }
    }




    var ckey = 'guide_step';
    var path = '/';
    $(document).ready(function() {
        $(".shop-guide-wrapper").hide();
        continueLastStep();
    });
    //根据cookie判断跳转的页面
    function continueLastStep(){
        var step = $.cookie(ckey);
        if(step==null||step=='0'){
            // 记录向导的步骤
            $.cookie(ckey, '0', { expires: 365, path: path });
            $("#step-0").show();
        }else{
            $("#step-"+step).show();
        }
    }
    // 跳转到某个步骤
    function nextStep(step){
        if(step=='1'){  //开始向导
            $.cookie('guideSidebar', null);
            $.cookie('closeAutoGuide', 'true', { expires: 1 });  //关闭自动弹出开店向导
            $("#guideSidebar").removeClass("hide-i");
        }
        // cookie值修改
        $.cookie(ckey, step, { expires: 365, path: path });
        $(".shop-guide-wrapper").hide();
        $("#step-"+step).show();
    }
    //完成
    function completeStep(){
        //隐藏向导侧栏
        $('#kdxd').modal('hide');
        nextStep('1');
    }
    //跳转到相应的页面
    function toSetPage(url){
        closeDialog();
        if(url!=null && url.indexOf("/store")==0){
            unfoldMenu(url, '2');
        }else{
            unfoldMenu(url, '1');
        }
    }

    function toB2c(furl, extended, cssTargetUrl,subUrl){
        unfoldMenu(furl, extended, cssTargetUrl,subUrl);
        closeDialog();
    }

</script>
    