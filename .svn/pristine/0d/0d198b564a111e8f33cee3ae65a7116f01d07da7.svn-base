var basePath = $("#basePath").val();
$(function(){
});

/**
 * 提交添加品牌form
 */
var num=0;
function submitSaveBrandForm() {
    var brandName=$("#addBrandName").val();
    if(brandName==''){
        $("#helpTip").hide();
    }
    $("#saveBrandForm input").each(function () {
        $(this).removeClass("ignore");
    });
    $("#saveBrandForm").attr("action","saveBrand.htm");
    $("#saveBrandForm").attr("target","_self");
    if(brandName!=null && brandName!=''&&num==0){
        $.ajax({
            url:'selectByBrandName.htm?brandName='+brandName+"&CSRFToken="+$("#CSRFToken").val(),
            success:function(data) {
                if(data==0) {
                    num+=1;
                    //不重复则提交表单
                    $("#addBrandName").removeClass("error");
                    $("#helpTip").hide();
                    $("#saveBrandForm").submit();
                }else{
                    //重复错误提示
                    $("#addBrandName").addClass("error");
                    $("#helpTip").show();
                }
            }
        });
    }else{
        $("#addBrandName").removeClass("error");
        $("#helpTip").hide();
        $("#saveBrandForm").submit();
    }
}

/**
 * 提交编辑form
 */
function submitUpdateForm() {
    if(!$("#editBrandForm").valid()){
        return;
    }

    $("#editBrandForm input").each(function () {
        $(this).removeClass("ignore");
    });
    $("#editBrandForm").attr("action",basePath+"/ThirdPlatformAdmin/saveThirdPlatform");
    $("#editBrandForm").attr("target","_self");

    if($(".add_title").html() == "添加"){
        checkThirdUser($("#companyName").val(),$("#storeName").val(),$("#thirdUserName").val());
    }else{
        if($("#companyName").val() == companyNameOld){
            companyNameOld = "";
        }
        if($("#storeName").val() == storeNameOld){
            storeNameOld = "";
        }
        if($("#thirdUserName").val() == thirdUserNameOld){
            thirdUserNameOld = "";
        }
        checkThirdUser(companyNameOld,storeNameOld,thirdUserNameOld);
    }

}

function checkThirdUser(companyName,storeName,thirdUserName){
    $.ajax({
        url:basePath+'/ThirdPlatformAdmin/checkThirdUser',
        data:{companyName:companyName,storeName:storeName,thirdUserName: thirdUserName},
        async: false,
        success:function(data) {
            if(data == '200'){
                $("#editBrandForm").submit();
            }else{
                showTipAlert(data);
            }
        }
    });
}

/**
 * 弹出显示编辑
 */
var companyNameOld;
var storeNameOld;
var thirdUserNameOld;
function updateThirdPlatfrom(thirdId) {
    if(typeof (thirdId) != 'undefined'){
        $(".add_title").html("编辑");
        $.ajax({
            url:basePath+'/ThirdPlatformAdmin/queryById?id='+thirdId,
            dataType:'json',
            success:function(data) {
                $("#id").val(data.id);
                $("#companyName").val(data.companyName);
                $("#storeName").val(data.storeName);
                $("#thirdUserName").val(data.thirdUserName);
                $("#thirdUserPwd").val(data.thirdUserPwd);
                companyNameOld = data.companyName;
                storeNameOld = data.storeName;
                thirdUserNameOld = data.thirdUserName;
                $("input:radio[name='platformType'][value='"+data.platformType+"']").click();
                $("#editThirdPlatfrom").modal("show");
            }
        });
    }
    else{
        $(".add_title").html("添加");
        //测试要求添加商品时点取消后重新添加数据仍然存在，所以注释以下两行代码
        //$("#editBrandForm").find("input").val("");
        //$("input:radio[name='platformType']").eq(0).click();
        $("#editThirdPlatfrom").modal("show");
    }
}

function importBrand() {
    $("#importGoodsBrandForm").submit();
}